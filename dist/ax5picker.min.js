"use strict";!function(t,e){var i=ax5.util,n=function(){var t,n=this;e&&e.call(this),this.queue=[],this.config={clickEventName:"click",theme:"default",title:"",lang:{ok:"ok",cancel:"cancel"},animateTime:250},this.activePicker=null,this.activePickerQueueIndex=-1,t=this.config,this.init=function(){},this.bind=function(e){var n={};return jQuery.extend(!0,n,t),e&&jQuery.extend(!0,n,e),e=n,e.target?(e.$target=jQuery(e.target),e.id||(e.id="ax5-picker-"+ax5.getGuid()),-1===i.search(this.queue,function(){return this.id==e.id})&&(this.queue.push(e),this.bindPickerTarget(e,this.queue.length-1)),this):(console.log(ax5.info.getError("ax5picker","401","bind")),this)},this.bindPickerTarget=function(){var t={focus:function(t,e,i){this.open(t,e)},click:function(t,e,i){this.open(t,e)}},e={"@fn":function(t,e){var i={};t.$target.find('input[type="text"]').length;this.queue[e]=jQuery.extend(!0,i,t)},date:function(t,e){var i=t.content?t.content.width||270:270,n=t.content?t.content.margin||5:5,c={},r=t.$target.find('input[type="text"]').length;c={contentWidth:i*r+(r-1)*n,content:{width:i,margin:n},inputLength:r},console.log(this.queue[e]),this.queue[e]=jQuery.extend(!0,c,t),console.log(this.queue[e])}};return function(n,c){if(!n.content)return console.log(ax5.info.getError("ax5picker","501","bind")),this;if(i.isFunction(n.content))e["@fn"].call(this,n,c);else for(var r in e)if(n.content.type==r){e[r].call(this,n,c);break}return n.$target.find('input[type="text"]').unbind("focus.ax5picker").bind("focus.ax5picker",t.focus.bind(this,this.queue[c],c)),n.$target.find(".input-group-addon").unbind("click.ax5picker").bind("click.ax5picker",t.click.bind(this,this.queue[c],c)),this}}(),this.getTmpl=function(t,e){return'\n            <div class="ax5-ui-picker {{theme}}" id="{{id}}" data-picker-els="root">\n                {{#title}}\n                    <div class="ax-picker-heading">{{title}}</div>\n                {{/title}}\n                <div class="ax-picker-body">\n                    <div class="ax-picker-contents" data-picker-els="contents" style="width:{{contentWidth}}px;"></div>\n                    {{#btns}}\n                        <div class="ax-picker-buttons">\n                        {{#btns}}\n                            {{#@each}}\n                            <button data-picker-btn="{{@key}}" class="btn btn-default {{@value.theme}}">{{@value.label}}</button>\n                            {{/@each}}\n                        {{/btns}}\n                        </div>\n                    {{/btns}}\n                </div>\n                <div class="ax-picker-arrow"></div>\n            </div>\n            '},this.setContentValue=function(t,e,i){var n=this.queue[ax5.util.search(this.queue,function(){return this.id==t})];n&&(jQuery(n.$target.find('input[type="text"]').get(e)).val(i),1==n.inputLength&&this.close())},this.open=function(){var e={"@fn":function(t,e,i){return t.content.call(t,function(t){i(t)}),!0},date:function(t,e,c){for(var r=[],a=0;a<t.inputLength;a++)r.push('<div style="width:'+i.cssNumber(t.content.width)+';float:left;" class="ax-picker-content-box" data-calendar-target="'+a+'"></div>'),a<t.inputLength-1&&r.push('<div style="width:'+t.content.margin+'px;float:left;height: 5px;"></div>');r.push('<div style="clear:both;"></div>'),c.html(r.join(""));var s={displayDate:new Date,control:{left:'<i class="fa fa-chevron-left"></i>',yearTmpl:"%s",monthTmpl:"%s",right:'<i class="fa fa-chevron-right"></i>',yearFirst:!0}};c.find("[data-calendar-target]").each(function(e){var i=t.$target.find('input[type="text"]').get(e).value,c=ax5.util.date(i);s.displayDate=c,i&&(s.selection=[c]),s=jQuery.extend(!0,s,t.content.config||{}),s.target=this,s.onClick=function(){n.setContentValue(t.id,e,this.date)},new ax5.ui.calendar(s)})}};return function(c,r,a){if(this.openTimer&&clearTimeout(this.openTimer),this.activePicker)return this.activePickerQueueIndex==r?this:a>2?this:(this.close(),this.openTimer=setTimeout(function(){this.open(c,r,(a||0)+1)}.bind(this),t.animateTime),this);this.activePicker=jQuery(ax5.mustache.render(this.getTmpl(c,r),c)),this.activePickerQueueIndex=r;var s=this.activePicker.find('[data-picker-els="contents"]');if(i.isFunction(c.content))s.html("Loading.."),e["@fn"].call(this,c,r,function(t){s.html(t)});else for(var o in e)if(c.content.type==o){e[o].call(this,c,r,s);break}return n.__alignPicker("append"),jQuery(window).bind("resize.ax5picker",function(){n.__alignPicker()}),jQuery(window).bind("click.ax5picker",function(t){t=t||window.event,n.__onBodyClick(t);try{t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0}catch(t){}return!1}),this}}(),this.close=function(){if(!this.activePicker)return this;var e=this.queue[this.activePickerQueueIndex];return this.activePicker.addClass("destroy"),jQuery(window).unbind("resize.ax5picker"),jQuery(window).unbind("click.ax5picker"),setTimeout(function(){this.activePicker&&this.activePicker.remove(),this.activePicker=null,this.activePickerQueueIndex=-1,e&&e.onStateChanged&&(that={state:"close"},e.onStateChanged.call(that,that))}.bind(this),t.animateTime),this},this.__onBodyClick=function(t,e){if(!this.activePicker)return this;var n=this.queue[this.activePickerQueueIndex];return e=i.findParentNode(t.target,function(t){return t.getAttribute("data-picker-els")?!0:n.$target.get(0)==t?!0:void 0}),e?this:(this.close(),this)},this.__alignPicker=function(t){if(!this.activePicker)return this;var e=this.queue[this.activePickerQueueIndex],i={},n={};t&&jQuery(document.body).append(this.activePicker),i=e.$target.offset(),n={width:e.$target.outerWidth(),height:e.$target.outerHeight()},e.direction&&""!==e.direction&&"auto"!==e.direction||(e.direction="top"),t&&this.activePicker.addClass("direction-"+e.direction),this.activePicker.css(function(){return"top"==e.direction?{left:i.left+n.width/2-this.activePicker.outerWidth()/2,top:i.top+n.height+12}:"bottom"==e.direction?{left:i.left+n.width/2-this.activePicker.outerWidth()/2,top:i.top-this.activePicker.outerHeight()-12}:"left"==e.direction?{left:i.left+n.width+12,top:i.top-n.height/2}:"right"==e.direction?{left:i.left-this.activePicker.outerWidth()-12,top:i.top-n.height/2}:void 0}.call(this))},this.main=function(){arguments&&i.isObject(arguments[0])&&this.setConfig(arguments[0])}.apply(this,arguments)};t.picker=function(){return i.isFunction(e)&&(n.prototype=new e),n}()}(ax5.ui,ax5.ui.root);